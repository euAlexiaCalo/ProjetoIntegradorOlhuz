<?xml version="1.0" encoding="utf-8" ?>
<ContentView
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:models="clr-namespace:Olhuz.Models"
    x:Class="Olhuz.Components.SideMenuView"
    x:Name="MenuView"
    BackgroundColor="{AppThemeBinding Light={StaticResource LightBackground}, Dark={StaticResource DarkBackground}}">

    <!-- Conte�do principal -->
    <Grid RowDefinitions="2*, 8.5*">
        <!-- Cabe�alho (Linha 0) -->
        <HorizontalStackLayout
            Grid.Row="0"
            HorizontalOptions="Center"
            VerticalOptions="Center"
            Spacing="14"
            Margin="0,0,10,0"
            MinimumHeightRequest="60"
            Padding="0">

            <Image
                Source="logo.png"
                Aspect="AspectFit"
                MaximumWidthRequest="60"
                VerticalOptions="Center"/>

            <Label
                Text="Olhuz"
                FontSize="40"
				TextColor="{AppThemeBinding Light={StaticResource ColorBlack}, Dark={StaticResource ColorWhite}}"
                VerticalOptions="Center"/>

        </HorizontalStackLayout>

        <!-- Menu (Linha 1) -->
        <Border
            Grid.Row="1"
            BackgroundColor="{AppThemeBinding Light={StaticResource LightNavCardBackground}, Dark={StaticResource DarkNavCardBackground}}"
            StrokeShape="RoundRectangle 0 200 0 0"
            StrokeThickness="0"
            Shadow="{x:Null}"
            HorizontalOptions="Fill">

            <VerticalStackLayout VerticalOptions="Center" Padding="0">
                <!-- ADICIONADO x:Name para o Controller se referir � lista de itens -->
                <VerticalStackLayout x:Name="MenuStackLayout"
                                     BindableLayout.ItemsSource="{Binding Items}">
                    <BindableLayout.ItemTemplate>
                        <DataTemplate x:DataType="models:MenuItemModel">

                            <Border
                                x:Name="MenuOptionBorder"
                                StrokeThickness="0"
                                StrokeShape="RoundRectangle 40 0 40 0"
                                Padding="20, 20"
                                Margin="10, 4, 0,4"
                                Shadow="{x:Null}">

                                <VisualStateManager.VisualStateGroups>
                                    <VisualStateGroup x:Name="CommonStates">
                                        <VisualState x:Name="Normal" />
                                        <VisualState x:Name="PointerOver">
                                            <VisualState.Setters>
                                                <Setter Property="BackgroundColor" Value="{AppThemeBinding Light={StaticResource LightMenuItemHover}, Dark={StaticResource DarkMenuItemHover}}" />
                                            </VisualState.Setters>
                                        </VisualState>
                                    </VisualStateGroup>
                                </VisualStateManager.VisualStateGroups>

                                <Border.Triggers>
                                    <!-- A propriedade IsSelected do Model (MenuItemModel) ainda controla o visual -->
                                    <DataTrigger TargetType="Border" Binding="{Binding IsSelected}" Value="True">
                                        <Setter Property="BackgroundColor" Value="{AppThemeBinding Light={StaticResource LightMenuItemSelected}, Dark={StaticResource DarkMenuItemSelected}}" />
                                    </DataTrigger>

                                    <DataTrigger TargetType="Border" Binding="{Binding IsSelected}" Value="False">
                                        <Setter Property="BackgroundColor" Value="Transparent" />
                                    </DataTrigger>
                                </Border.Triggers>

                                <Border.GestureRecognizers>
                                    <!-- Evento Tapped que ser� tratado no Code-Behind (Controller) -->
                                    <TapGestureRecognizer Tapped="OnMenuItemTapped"/>
                                </Border.GestureRecognizers>

                                <HorizontalStackLayout Spacing="24">
                                    <Image HeightRequest="30" Aspect="AspectFit" Source="{Binding Icon}" />

                                    <Label
                                        Text="{Binding Title}"
                                        TextColor="{AppThemeBinding Light={StaticResource ColorBlack}, Dark={StaticResource ColorWhite}}"
                                        FontSize="24"
                                        VerticalOptions="Center"/>
                                </HorizontalStackLayout>

                            </Border>
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </VerticalStackLayout>
            </VerticalStackLayout>
        </Border>
    </Grid>
</ContentView>